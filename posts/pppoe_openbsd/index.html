<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>PPPoE on OpenBSD - JWillikers</title><meta name="Description" content="Jordan Williams&#39; developer blog"><meta property="og:title" content="PPPoE on OpenBSD" />
<meta property="og:description" content="Some ISP&#8217;s establish connections with their customers&#39; networks through PPPoE. I recently setup an OpenBSD 6.6 router which required PPPoE. This is my story.
DNS ServersIf necessary, configure your system to use your preferred DNS nameservers.
Tip: A common way of connecting to your ISP&#8217;s network is through DHCP. DHCP is capable of providing your system with DNS nameservers according to RFC 2132 and RFC 2937. To my knowledge, this capability is absent from the PPPoE Specification." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jwillikers.com/posts/pppoe_openbsd/" />
<meta property="article:published_time" content="2020-03-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-14T16:30:29-05:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PPPoE on OpenBSD"/>
<meta name="twitter:description" content="Some ISP&#8217;s establish connections with their customers&#39; networks through PPPoE. I recently setup an OpenBSD 6.6 router which required PPPoE. This is my story.
DNS ServersIf necessary, configure your system to use your preferred DNS nameservers.
Tip: A common way of connecting to your ISP&#8217;s network is through DHCP. DHCP is capable of providing your system with DNS nameservers according to RFC 2132 and RFC 2937. To my knowledge, this capability is absent from the PPPoE Specification."/>
<meta name="application-name" content="JWillikers">
<meta name="apple-mobile-web-app-title" content="JWillikers"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jwillikers.com/posts/pppoe_openbsd/" /><link rel="next" href="https://jwillikers.com/posts/unbound_adblock/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "PPPoE on OpenBSD",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jwillikers.com\/posts\/pppoe_openbsd\/"
        },"genre": "posts","keywords": "BSD, OpenBSD, OpenBSD6, OpenBSD66, PPPoE","wordcount":  342 ,
        "url": "https:\/\/jwillikers.com\/posts\/pppoe_openbsd\/","datePublished": "2020-03-12T00:00:00+00:00","dateModified": "2020-07-14T16:30:29-05:00","publisher": {
            "@type": "Organization",
            "name": "Jordan Williams"},"author": {
                "@type": "Person",
                "name": "Jordan Williams"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="JWillikers">JWillikers</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/contact/"> Contact </a><a class="menu-item" href="/resources/"> Resources </a><a class="menu-item" href="https://github.com/jwillikers/blog" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="JWillikers">JWillikers</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/contact/" title="">Contact</a><a class="menu-item" href="/resources/" title="">Resources</a><a class="menu-item" href="https://github.com/jwillikers/blog" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">PPPoE on OpenBSD</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jordan Williams</a></span>&nbsp;<span class="post-category">included in <a href="/categories/networking/"><i class="far fa-folder fa-fw"></i>Networking</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-03-12">2020-03-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;342 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"></div>
            </div><div class="content" id="content"><p>Some ISP&#8217;s establish connections with their customers' networks through PPPoE.
I recently setup an OpenBSD 6.6 router which required PPPoE.
This is my story.</p>
<section class="doc-section level-1"><h2 id="_dns_servers">DNS Servers</h2><p>If necessary, configure your system to use your preferred DNS nameservers.</p>
<aside class="admonition-block tip" role="doc-tip"><h6 class="block-title label-only"><span class="title-label">Tip: </span></h6><p>A common way of connecting to your ISP&#8217;s network is through <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a>.
DHCP is capable of providing your system with DNS nameservers according to <a href="https://tools.ietf.org/html/rfc2132#section-3.8">RFC 2132</a> and <a href="https://tools.ietf.org/html/rfc2937">RFC 2937</a>.
To my knowledge, this capability is absent from the <a href="https://tools.ietf.org/html/rfc2516">PPPoE Specification</a>.
If you are switching from DHCP to PPPoE, be mindful that you may need to set your nameservers if you have not explicitly done so.</p></aside>
<p>The place to do this is <a href="https://man.openbsd.org/resolv.conf.5">resolv.conf</a>.
My system uses a couple of nameservers from the <a href="https://dnscrypt.info/public-servers">list provided by DNSCrypt</a>.
The <a href="https://developers.google.com/speed/public-dns">Google nameservers</a> are also quite popular.</p>
<figure class="listing-block"><figcaption>/etc/resolv.conf</figcaption>
<pre class="rouge highlight"><code>nameserver 176.103.130.132 <b class="conum">1</b>
nameserver 185.228.168.10 <b class="conum">2</b></code></pre><ol class="callout-list arabic"><li>adguard-dns-family</li><li>cleanbrowsing-adult</li></ol></figure>
</section>
<section class="doc-section level-1"><h2 id="_pppoe_configuration">PPPoE Configuration</h2><p>The configuration is fairly straightforward.
I use a <a href="https://man.openbsd.org/OpenBSD-6.6/hostname.if">hostname.if</a> file to initialize the PPPoE interface when the system boots.
This example is very similar to the jumbo frames example provided in the <a href="https://man.openbsd.org/OpenBSD-6.6/pppoe#MTU/MSS_ISSUES">PPPOE(4)</a> manpage.
Because this is a router, it requires more than the basic setup. PPPoE has an overhead and the incoming LAN connections will not be aware of this.
My modifications to the example are as follows.
First, <code>chap</code> replaces <code>pap</code> as the authentication protocol.
Second, only IPv4 options are present since my ISP doesn&#8217;t support IPv6.</p>
<figure class="listing-block"><figcaption>/etc/hostname.pppoe0</figcaption>
<pre class="rouge highlight"><code>inet 0.0.0.0 255.255.255.255 NONE mtu 1500 \ <b class="conum">1</b>
	pppoedev em0 authproto chap \ <b class="conum">2</b>
	authname 'username' authkey 'password' up
dest 0.0.0.1
!/sbin/route add default -ifp pppoe0 0.0.0.1</code></pre><ol class="callout-list arabic"><li>Set the IP to <code>0.0.0.0</code>, a wildcard representing whatever IP the PPPoE connection provides, and adjust the frame size.</li><li><code>em0</code> is the ethernet interface for the router&#8217;s WAN port.</li></ol></figure>

<p>The physical <code>em0</code> interface must be up.</p>
<figure class="listing-block"><figcaption>/etc/hostname.em0</figcaption>
<pre class="rouge highlight"><code>up mtu 1508</code></pre></figure>
<p>Start up the <code>em0</code> and <code>pppoe0</code> interfaces.</p>
<div class="listing-block"><pre class="rouge highlight"><code data-lang="console"><span class="go">sh /etc/netstart em0 pppoe0</span></code></pre></div>
<section class="admonition-block caution" role="doc-notice"><h6 class="block-title label-only"><span class="title-label">Caution: </span></h6><p>The <code>/etc/netstart</code> script was not able to successfully establish a PPPoE connection when I changed my configuration from <code>pap</code> to <code>chap</code>.
I had to reboot my system after changing the configuration file for the connection to succeed.</p>
<div class="listing-block"><pre class="rouge highlight"><code data-lang="console"><span class="go">reboot</span></code></pre></div></section></section>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-07-14</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/bsd/">BSD</a>,&nbsp;<a href="/tags/openbsd/">OpenBSD</a>,&nbsp;<a href="/tags/openbsd6/">OpenBSD6</a>,&nbsp;<a href="/tags/openbsd66/">OpenBSD66</a>,&nbsp;<a href="/tags/pppoe/">PPPoE</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/posts/unbound_adblock/" class="next" rel="next" title="Unbound Adblock">Unbound Adblock<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Jordan Williams</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
