<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>&#34;Too many open files&#34; when Compiling on macOS - JWillikers</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Jordan Williams" /><meta name="description" content="Occasionally things just go wrong during large builds. One such occurrence is on macOS when compiling a large C&#43;&#43; project.
ProblemThe following error message is output by LLVM Clang 10.0.1 when compiling from the command-line. The Clion IDE builds the project just fine, of course.
$ cmake --build build ... In file included from /opt/local/include/boost/spirit/home/x3.hpp:19: In file included from /opt/local/include/boost/spirit/home/x3/operator.hpp:10: In file included from /opt/local/include/boost/spirit/home/x3/operator/sequence.hpp:12: /opt/local/include/boost/spirit/home/x3/operator/detail/sequence.hpp:25:10: fatal error: cannot open file &amp;#39;/opt/local/include/boost/fusion/include/as_deque." /><meta name="keywords" content="Blog, BSD, Linux" />






<meta name="generator" content="Hugo 0.75.1 with theme even" />


<link rel="canonical" href="https://jwillikers.com/post/too_many_open_files_on_macos_when_compiling/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/syntax.css">


<meta property="og:title" content="&#34;Too many open files&#34; when Compiling on macOS" />
<meta property="og:description" content="Occasionally things just go wrong during large builds. One such occurrence is on macOS when compiling a large C&#43;&#43; project.
ProblemThe following error message is output by LLVM Clang 10.0.1 when compiling from the command-line. The Clion IDE builds the project just fine, of course.
$ cmake --build build ... In file included from /opt/local/include/boost/spirit/home/x3.hpp:19: In file included from /opt/local/include/boost/spirit/home/x3/operator.hpp:10: In file included from /opt/local/include/boost/spirit/home/x3/operator/sequence.hpp:12: /opt/local/include/boost/spirit/home/x3/operator/detail/sequence.hpp:25:10: fatal error: cannot open file &#39;/opt/local/include/boost/fusion/include/as_deque." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jwillikers.com/post/too_many_open_files_on_macos_when_compiling/" />
<meta property="article:published_time" content="2020-10-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-10-02T15:15:22-05:00" />
<meta itemprop="name" content="&#34;Too many open files&#34; when Compiling on macOS">
<meta itemprop="description" content="Occasionally things just go wrong during large builds. One such occurrence is on macOS when compiling a large C&#43;&#43; project.
ProblemThe following error message is output by LLVM Clang 10.0.1 when compiling from the command-line. The Clion IDE builds the project just fine, of course.
$ cmake --build build ... In file included from /opt/local/include/boost/spirit/home/x3.hpp:19: In file included from /opt/local/include/boost/spirit/home/x3/operator.hpp:10: In file included from /opt/local/include/boost/spirit/home/x3/operator/sequence.hpp:12: /opt/local/include/boost/spirit/home/x3/operator/detail/sequence.hpp:25:10: fatal error: cannot open file &#39;/opt/local/include/boost/fusion/include/as_deque.">
<meta itemprop="datePublished" content="2020-10-02T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-10-02T15:15:22-05:00" />
<meta itemprop="wordCount" content="538">



<meta itemprop="keywords" content="Catalina,fish,launchd,macOS,shell,ulimit," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="&#34;Too many open files&#34; when Compiling on macOS"/>
<meta name="twitter:description" content="Occasionally things just go wrong during large builds. One such occurrence is on macOS when compiling a large C&#43;&#43; project.
ProblemThe following error message is output by LLVM Clang 10.0.1 when compiling from the command-line. The Clion IDE builds the project just fine, of course.
$ cmake --build build ... In file included from /opt/local/include/boost/spirit/home/x3.hpp:19: In file included from /opt/local/include/boost/spirit/home/x3/operator.hpp:10: In file included from /opt/local/include/boost/spirit/home/x3/operator/sequence.hpp:12: /opt/local/include/boost/spirit/home/x3/operator/detail/sequence.hpp:25:10: fatal error: cannot open file &#39;/opt/local/include/boost/fusion/include/as_deque."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">JWillikers</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/resources/">
        <li class="mobile-menu-item">Resources</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">JWillikers</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/resources/">Resources</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">&#34;Too many open files&#34; when Compiling on macOS</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-10-02 </span>
        <div class="post-category">
            <a href="/categories/command-line/"> Command-line </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>Occasionally things just go wrong during large builds.
One such occurrence is on macOS when compiling a large C++ project.</p>
<section class="doc-section level-1"><h2 id="_problem">Problem</h2><p>The following error message is output by <a href="https://clang.llvm.org/">LLVM Clang</a> 10.0.1 when compiling from the command-line.
The <a href="https://www.jetbrains.com/clion/">Clion IDE</a> builds the project just fine, of course.</p>
<div class="listing-block"><pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>cmake <span class="nt">--build</span> build
...
In file included from /opt/local/include/boost/spirit/home/x3.hpp:19:
In file included from /opt/local/include/boost/spirit/home/x3/operator.hpp:10:
In file included from /opt/local/include/boost/spirit/home/x3/operator/sequence.hpp:12:
/opt/local/include/boost/spirit/home/x3/operator/detail/sequence.hpp:25:10: fatal error: cannot open file <span class="s1">&#39;/opt/local/include/boost/fusion/include/as_deque.hpp&#39;</span>: Too many open files
<span class="c">#include &lt;boost/fusion/include/as_deque.hpp&gt;</span>
         ^
1 error generated.</code></pre></div>
<p>Too many open files…​
Really?
What decade is this?!</p></section>
<section class="doc-section level-1"><h2 id="_solution">Solution</h2><p>According to Wilson Mar’s article <a href="https://wilsonmar.github.io/maximum-limits/"><em>Maximum limits (in macOS file descriptors)</em></a>, this issue is caused by a low default limit for the number of files that can be open simultaneously.
Digging a little bit deeper into the <a href="x-man-page://launchctl"><code>launchctl</code></a> and <a href="x-man-page://setrlimit"><code>setrlimit</code></a> man pages, its important to note this limit is specific to a <em>single process</em>.
What follows are step-by-step instructions for detecting and resolving this issue.</p>
<div class="olist arabic"><ol class="arabic"><li><p>First, check the existing soft and hard limits for the maximum number of open files.</p><div class="open-block"><div class="content"><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ launchctl limit maxfiles
	maxfiles    256            unlimited</code></pre></div>
<p>In this case, the 256 file soft limit is the issue.
This limit is much too low.</p></div></div></li><li><p>For the running session, remedy the problem by setting higher limits with <code>launchctl</code>.</p><div class="open-block"><div class="content"><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ <span class="nb">sudo </span>launchctl limit maxfiles 65536 2147483647</code></pre></div>
<p>This sets the soft limit to 65,536 open files and the hard limit to 2,147,483,647 open files.</p>
<section class="admonition-block caution" role="doc-notice"><h6 class="block-title label-only"><span class="title-label">Caution: </span></h6><p>Don’t exceed the maximum number of 2,147,483,647 for either limit here.<a class="footnote-ref" id="_footnoteref_1" href="#_footnote_1" title="View footnote 1" role="doc-noteref">[1]</a></p></section></div></div></li><li><p>To persist this setting, create a <a href="x-man-page://launchd.plist"><code>launchd.plist</code></a> file which will be used to launch the command every time the machine boots.<a class="footnote-ref" id="_footnoteref_2" href="#_footnote_2" title="View footnote 2" role="doc-noteref">[2]</a></p><div class="open-block"><div class="content"><figure class="listing-block"><figcaption>/Library/LaunchDaemons/limit.maxfiles.plist</figcaption>
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34;
        &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&#34;1.0&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>limit.maxfiles<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
      <span class="nt">&lt;string&gt;</span>launchctl<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;string&gt;</span>limit<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;string&gt;</span>maxfiles<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;string&gt;</span>65536<span class="nt">&lt;/string&gt;</span>
      <span class="nt">&lt;string&gt;</span>2147483647<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
    <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;true/&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></figure>
<aside class="admonition-block note" role="note"><h6 class="block-title label-only"><span class="title-label">Note: </span></h6><p>Increasing this limit with <code>ulimit</code> from a startup shell script is quick and do-able.
However, such an approach only applies to a single user, doesn’t account for changing shells, and is more likely to accidentally be overwritten or deleted.</p></aside></div></div></li><li><p>Ensure the file is owned by the <code>root</code> user and belongs to the <code>wheel</code> group.</p><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ <span class="nb">sudo chown </span>root:wheel /Library/LaunchDaemons/limit.maxfiles.plist</code></pre></div></li><li><p>Set permissions on the file so that it is readable and writeable by the owner and only readable by group members and everyone else.</p><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ <span class="nb">sudo chmod </span>644 /Library/LaunchDaemons/limit.maxfiles.plist</code></pre></div></li><li><p>Create a system service from the script.<a class="footnote-ref" id="_footnoteref_3" href="#_footnote_3" title="View footnote 3" role="doc-noteref">[3]</a><a class="footnote-ref" id="_footnoteref_4" href="#_footnote_4" title="View footnote 4" role="doc-noteref">[4]</a></p><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ <span class="nb">sudo </span>launchctl bootstrap system /Library/LaunchDaemons/limit.maxfiles.plist</code></pre></div></li><li><p>Set the service to run at boot.</p><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ <span class="nb">sudo </span>launchctl <span class="nb">enable </span>system/limit.maxfiles</code></pre></div></li><li><p>Verify that the limits have been updated.</p><div class="listing-block"><pre>➜ launchctl limit maxfiles
	maxfiles    65536          2147483647</pre></div></li><li>Restart your terminal application to take advantage of the increased limits.</li><li><p>Check to make sure the changes have taken effect for your shell.</p><div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">➜ <span class="nb">ulimit</span> <span class="nt">-S</span> <span class="nt">-n</span>
65536</code></pre></div></li></ol></div></section>
<section class="doc-section level-1"><h2 id="_conclusion">Conclusion</h2><p>There’s a fair bit of work involved for this fix but it is quite robust.
Not only should file process limits not be an issue for you for the forseeable future, you should have gained some valuable insights into macOS service management with <code>launchd</code>.</p></section><section class="footnotes" aria-label="Footnotes" role="doc-endnotes"><hr/><ol class="footnotes"><li class="footnote" id="_footnote_1" role="doc-endnote"><a href="https://apple.stackexchange.com/a/366319/361122">AskDifferent: Why does setting the hard-limit for maxfiles to “unlimited” using <code>launchctl limit</code> result in a hard-limit slightly above the soft-limit?</a> <a class="footnote-backref" href="#_footnoteref_1" role="doc-backlink" title="Jump to the first occurrence in the text">↩</a></li><li class="footnote" id="_footnote_2" role="doc-endnote"><a href="https://stackoverflow.com/a/62784288/9835303">Too many open files with Mariadb 10.4.13 on Macos Catalina</a> <a class="footnote-backref" href="#_footnoteref_2" role="doc-backlink" title="Jump to the first occurrence in the text">↩</a></li><li class="footnote" id="_footnote_3" role="doc-endnote"><a href="https://apple.stackexchange.com/a/345974/361122">AskDifferent: How do I use non-“legacy” launchctl commands to load and unload plists?</a> <a class="footnote-backref" href="#_footnoteref_3" role="doc-backlink" title="Jump to the first occurrence in the text">↩</a></li><li class="footnote" id="_footnote_4" role="doc-endnote"><a href="https://babodee.wordpress.com/2016/04/09/launchctl-2-0-syntax/">Babo D’s Corner: Launchctl 2.0 Syntax</a> <a class="footnote-backref" href="#_footnoteref_4" role="doc-backlink" title="Jump to the first occurrence in the text">↩</a></li></ol></section>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/catalina/">Catalina</a>
          <a href="/tags/fish/">fish</a>
          <a href="/tags/launchd/">launchd</a>
          <a href="/tags/macos/">macOS</a>
          <a href="/tags/shell/">shell</a>
          <a href="/tags/ulimit/">ulimit</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/switch_to_fish/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Switch to fish</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/change_your_shell/">
            <span class="next-text nav-default">Change your Shell</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/jwillikers" class="iconfont icon-github" title="github"></a>
      <a href="https://gitlab.com/jwillikers" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://stackoverflow.com/users/9835303/" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="mailto:jordan@jwillikers.com" class="iconfont icon-email" title="email"></a>
  <a href="https://jwillikers.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020<span class="heart"><i class="iconfont icon-heart"></i></span><span>Jordan Williams
<br />
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0"
  src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
<br />
<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
  property="dct:title" rel="dct:type">JWillikers</span> by 
  <a xmlns:cc="http://creativecommons.org/ns#" href="https://jwillikers.com"
  property="cc:attributionName" rel="cc:attributionURL">Jordan Williams</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  Creative Commons Attribution-ShareAlike 4.0 International License</a>.
</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>








</body>
</html>
