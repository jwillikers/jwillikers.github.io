<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>PPPoE on OpenBSD - JWillikers</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Jordan Williams" /><meta name="description" content="Some ISP&amp;#8217;s establish connections with their customers&#39; networks through PPPoE. I recently setup an OpenBSD 6.6 router which required PPPoE. This is my story.
DNS ServersIf necessary, configure your system to use your preferred DNS nameservers.
Tip: A common way of connecting to your ISP&amp;#8217;s network is through DHCP. DHCP is capable of providing your system with DNS nameservers according to RFC 2132 and RFC 2937. To my knowledge, this capability is absent from the PPPoE Specification." /><meta name="keywords" content="Blog, BSD, Linux" />






<meta name="generator" content="Hugo 0.74.3 with theme even" />


<link rel="canonical" href="https://jwillikers.com/post/pppoe_openbsd/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.c7bc1becf36bcf6a9ebd25d2947e43a2eb745ddb0c9a32b43126fd7fa460c351.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/syntax.css">


<meta property="og:title" content="PPPoE on OpenBSD" />
<meta property="og:description" content="Some ISP&#8217;s establish connections with their customers&#39; networks through PPPoE. I recently setup an OpenBSD 6.6 router which required PPPoE. This is my story.
DNS ServersIf necessary, configure your system to use your preferred DNS nameservers.
Tip: A common way of connecting to your ISP&#8217;s network is through DHCP. DHCP is capable of providing your system with DNS nameservers according to RFC 2132 and RFC 2937. To my knowledge, this capability is absent from the PPPoE Specification." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jwillikers.com/post/pppoe_openbsd/" />
<meta property="article:published_time" content="2020-03-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-22T09:58:49-05:00" />
<meta itemprop="name" content="PPPoE on OpenBSD">
<meta itemprop="description" content="Some ISP&#8217;s establish connections with their customers&#39; networks through PPPoE. I recently setup an OpenBSD 6.6 router which required PPPoE. This is my story.
DNS ServersIf necessary, configure your system to use your preferred DNS nameservers.
Tip: A common way of connecting to your ISP&#8217;s network is through DHCP. DHCP is capable of providing your system with DNS nameservers according to RFC 2132 and RFC 2937. To my knowledge, this capability is absent from the PPPoE Specification.">
<meta itemprop="datePublished" content="2020-03-12T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-09-22T09:58:49-05:00" />
<meta itemprop="wordCount" content="342">



<meta itemprop="keywords" content="BSD,OpenBSD,OpenBSD6,OpenBSD66,PPPoE," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PPPoE on OpenBSD"/>
<meta name="twitter:description" content="Some ISP&#8217;s establish connections with their customers&#39; networks through PPPoE. I recently setup an OpenBSD 6.6 router which required PPPoE. This is my story.
DNS ServersIf necessary, configure your system to use your preferred DNS nameservers.
Tip: A common way of connecting to your ISP&#8217;s network is through DHCP. DHCP is capable of providing your system with DNS nameservers according to RFC 2132 and RFC 2937. To my knowledge, this capability is absent from the PPPoE Specification."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">JWillikers</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/resources/">
        <li class="mobile-menu-item">Resources</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">JWillikers</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/resources/">Resources</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">PPPoE on OpenBSD</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-03-12 </span>
        <div class="post-category">
            <a href="/categories/networking/"> Networking </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    
  </div>
</div>
    <div class="post-content">
      <p>Some ISP&#8217;s establish connections with their customers' networks through PPPoE.
I recently setup an OpenBSD 6.6 router which required PPPoE.
This is my story.</p>
<section class="doc-section level-1"><h2 id="_dns_servers">DNS Servers</h2><p>If necessary, configure your system to use your preferred DNS nameservers.</p>
<aside class="admonition-block tip" role="doc-tip"><h6 class="block-title label-only"><span class="title-label">Tip: </span></h6><p>A common way of connecting to your ISP&#8217;s network is through <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a>.
DHCP is capable of providing your system with DNS nameservers according to <a href="https://tools.ietf.org/html/rfc2132#section-3.8">RFC 2132</a> and <a href="https://tools.ietf.org/html/rfc2937">RFC 2937</a>.
To my knowledge, this capability is absent from the <a href="https://tools.ietf.org/html/rfc2516">PPPoE Specification</a>.
If you are switching from DHCP to PPPoE, be mindful that you may need to set your nameservers if you have not explicitly done so.</p></aside>
<p>The place to do this is <a href="https://man.openbsd.org/resolv.conf.5">resolv.conf</a>.
My system uses a couple of nameservers from the <a href="https://dnscrypt.info/public-servers">list provided by DNSCrypt</a>.
The <a href="https://developers.google.com/speed/public-dns">Google nameservers</a> are also quite popular.</p>
<figure class="listing-block"><figcaption>/etc/resolv.conf</figcaption>
<pre class="rouge highlight"><code>nameserver 176.103.130.132 <b class="conum">1</b>
nameserver 185.228.168.10 <b class="conum">2</b></code></pre><ol class="callout-list arabic"><li>adguard-dns-family</li><li>cleanbrowsing-adult</li></ol></figure>
</section>
<section class="doc-section level-1"><h2 id="_pppoe_configuration">PPPoE Configuration</h2><p>The configuration is fairly straightforward.
I use a <a href="https://man.openbsd.org/OpenBSD-6.6/hostname.if">hostname.if</a> file to initialize the PPPoE interface when the system boots.
This example is very similar to the jumbo frames example provided in the <a href="https://man.openbsd.org/OpenBSD-6.6/pppoe#MTU/MSS_ISSUES">PPPOE(4)</a> manpage.
Because this is a router, it requires more than the basic setup. PPPoE has an overhead and the incoming LAN connections will not be aware of this.
My modifications to the example are as follows.
First, <code>chap</code> replaces <code>pap</code> as the authentication protocol.
Second, only IPv4 options are present since my ISP doesn&#8217;t support IPv6.</p>
<figure class="listing-block"><figcaption>/etc/hostname.pppoe0</figcaption>
<pre class="rouge highlight"><code>inet 0.0.0.0 255.255.255.255 NONE mtu 1500 \ <b class="conum">1</b>
	pppoedev em0 authproto chap \ <b class="conum">2</b>
	authname 'username' authkey 'password' up
dest 0.0.0.1
!/sbin/route add default -ifp pppoe0 0.0.0.1</code></pre><ol class="callout-list arabic"><li>Set the IP to <code>0.0.0.0</code>, a wildcard representing whatever IP the PPPoE connection provides, and adjust the frame size.</li><li><code>em0</code> is the ethernet interface for the router&#8217;s WAN port.</li></ol></figure>

<p>The physical <code>em0</code> interface must be up.</p>
<figure class="listing-block"><figcaption>/etc/hostname.em0</figcaption>
<pre class="rouge highlight"><code>up mtu 1508</code></pre></figure>
<p>Start up the <code>em0</code> and <code>pppoe0</code> interfaces.</p>
<div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">sh /etc/netstart em0 pppoe0</code></pre></div>
<section class="admonition-block caution" role="doc-notice"><h6 class="block-title label-only"><span class="title-label">Caution: </span></h6><p>The <code>/etc/netstart</code> script was not able to successfully establish a PPPoE connection when I changed my configuration from <code>pap</code> to <code>chap</code>.
I had to reboot my system after changing the configuration file for the connection to succeed.</p>
<div class="listing-block"><pre class="rouge highlight"><code data-lang="sh">reboot</code></pre></div></section></section>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/bsd/">BSD</a>
          <a href="/tags/openbsd/">OpenBSD</a>
          <a href="/tags/openbsd6/">OpenBSD6</a>
          <a href="/tags/openbsd66/">OpenBSD66</a>
          <a href="/tags/pppoe/">PPPoE</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/unbound_adblock/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Unbound Adblock</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/auto_mount_nextcloud/">
            <span class="next-text nav-default"></span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/jwillikers" class="iconfont icon-github" title="github"></a>
      <a href="https://gitlab.com/jwillikers" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://stackoverflow.com/users/9835303/" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="mailto:jordan@jwillikers.com" class="iconfont icon-email" title="email"></a>
  <a href="https://jwillikers.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020<span class="heart"><i class="iconfont icon-heart"></i></span><span>Jordan Williams
<br />
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0"
  src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
<br />
<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
  property="dct:title" rel="dct:type">JWillikers</span> by 
  <a xmlns:cc="http://creativecommons.org/ns#" href="https://jwillikers.com"
  property="cc:attributionName" rel="cc:attributionURL">Jordan Williams</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  Creative Commons Attribution-ShareAlike 4.0 International License</a>.
</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>








</body>
</html>
