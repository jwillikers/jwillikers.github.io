<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Automatically Update Antigen - JWillikers</title>
<meta name="description" content="Handy admin and dev guides from my myriad of tinkering">


  <meta name="author" content="Jordan Williams">
  
  <meta property="article:author" content="Jordan Williams">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="JWillikers">
<meta property="og:title" content="Automatically Update Antigen">
<meta property="og:url" content="https://jwillikers.com/automatically-update-antigen">


  <meta property="og:description" content="Handy admin and dev guides from my myriad of tinkering">







  <meta property="article:published_time" content="2020-09-23T00:00:00-05:00">






<link rel="canonical" href="https://jwillikers.com/automatically-update-antigen">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Jordan Williams <br /> <a rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\"> <img alt=\"Creative Commons License\" style=\"border-width:0\"\n  src=\"https://i.creativecommons.org/l/by-sa/4.0/88x31.png\" /></a>\n<br /> <span xmlns:dct=\"http://purl.org/dc/terms/\" href=\"http://purl.org/dc/dcmitype/Text\"\n  property=\"dct:title\" rel=\"dct:type\">JWillikers</span> by \n  <a xmlns:cc=\"http://creativecommons.org/ns#\" href=\"https://jwillikers.com\"\n  property=\"cc:attributionName\" rel=\"cc:attributionURL\">Jordan Williams</a>\n  is licensed under a \n  <a rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\">\n  Creative Commons Attribution-ShareAlike 4.0 International License</a>",
      "url": "https://jwillikers.com/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="JWillikers Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--default">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          JWillikers
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>There&#8217;s a catch when it comes to managing plugins with <a href="http://antigen.sharats.me/">Antigen</a> as done in <a href="configure-zsh.html">Configure ZSH</a>.</p>
</div>
<div class="quoteblock">
<div class="title">According to the Antigen documentation:</div>
<blockquote>
This is something you might not want to put in your .zshrc. Instead, run it occasionally to update your plugins.
</blockquote>
<div class="attribution">
&#8212; Antigen Wiki: Commands - antigen update
</div>
</div>
<div class="paragraph">
<p>I hate having to do any form of maintenance <em>occasionally</em>, especially simple maintenance.
This has two potential outcomes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Completely forget to do it ever.</p>
</li>
<li>
<p>Do it incessantly.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Okay, there are more than just those two options.
You could create some sort of <em>plan</em> for how often to do this.
But, if you are going to so much work you might just want to automate it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial">Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial explains how to configure <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> services and timers to automatically update a user&#8217;s ZSH plugins with Antigen once a week.
This tutorial is broken into two sections, each of which accomplishes the same goal.
The first describes how to use systemd user service and the second a system service for those unfortunate enough to be using Red Hat Enterprise Linux 7 and CentOS 7.</p>
</div>
<div class="sect2">
<h3 id="user_level_update_service">User-level Update Service</h3>
<div class="paragraph">
<p>This particular use-case is a good fit for <a href="https://wiki.archlinux.org/index.php/Systemd/User">systemd user services</a> because an Antigen and ZSH setup is a user-specific configuration.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the systemd user configuration directory.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.config/systemd/user</code></pre>
</div>
</div>
</li>
<li>
<p>Create a systemd service to update the Antigen plugins.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">~/.config/systemd/user/update-antigen.service</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Update Antigen</span>

<span class="nn">[Service]</span>
<span class="py">Type</span><span class="p">=</span><span class="s">oneshot</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/usr/bin/zsh -c '. "$0" &amp;&amp; exec "$@"' /home/jordan/.zshrc antigen update</span>

<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">default.target</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The command-line here is tricky because the <code>antigen update</code> command requires that the user&#8217;s Antigen functions and configuration be loaded.
Of course, systemd is not going to run a command from this context automatically because it throws reproducibility right out the window.
Thankfully some bash magic can make it happen.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
</div>
</div>
</li>
<li>
<p>Test run the new systemd unit.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>systemctl <span class="nt">--user</span> start update-antigen.service</code></pre>
</div>
</div>
</li>
<li>
<p>Check the output of the command to make sure everything worked.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>systemctl <span class="nt">--user</span> status update-antigen.service
● update-antigen.service - Update Antigen
     Loaded: loaded <span class="o">(</span>/home/jordan/.config/systemd/user/update-antigen.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
     Active: inactive <span class="o">(</span>dead<span class="o">)</span> since Tue 2020-09-22 15:36:26 CDT<span class="p">;</span> 2min 51s ago
TriggeredBy: ● update-antigen.timer
    Process: 557748 <span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/zsh <span class="nt">-c</span> <span class="nb">.</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">exec</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> /home/jordan/.zshrc antigen update <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
   Main PID: 557748 <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>

Sep 22 15:36:23 jwillikers systemd[7678]: Starting Update Antigen...
Sep 22 15:36:24 jwillikers zsh[557748]: Updating robbyrussell/oh-my-zsh@master... Done. Took 0s.
Sep 22 15:36:25 jwillikers zsh[557748]: Updating zsh-users/zsh-autosuggestions@master... Done. Took 1s.
Sep 22 15:36:25 jwillikers zsh[557748]: Updating zsh-users/zsh-completions@master... Done. Took 0s.
Sep 22 15:36:26 jwillikers zsh[557748]: Updating zsh-users/zsh-syntax-highlighting@master... Done. Took 1s.
Sep 22 15:36:26 jwillikers systemd[7678]: update-antigen.service: Succeeded.
Sep 22 15:36:26 jwillikers systemd[7678]: Finished Update Antigen.</code></pre>
</div>
</div>
</li>
<li>
<p>Add a systemd timer to update the Antigen plugins once per week.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">~/.config/systemd/user/update-antigen.timer</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Update Antigen weekly</span>

<span class="nn">[Timer]</span>
<span class="py">Persistent</span><span class="p">=</span><span class="s">true</span>
<span class="py">OnCalendar</span><span class="p">=</span><span class="s">weekly</span>

<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">timers.target</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This timer has <code>Persistent=true</code> to account for the situation when the timer would fire but the user has no session running.
With this option, the timer will just fire the next time the user logs on.</p>
</div>
</div>
</div>
</li>
<li>
<p>Set the the Antigen update timer to start when logging in.<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>systemctl <span class="nt">--user</span> <span class="nb">enable </span>update-antigen.timer
Created symlink /home/jordan/.config/systemd/user/timers.target.wants/update-antigen.timer → /home/jordan/.config/systemd/user/update-antigen.timer.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="system_level_update_service">System-level Update Service</h3>
<div class="paragraph">
<p>The Red Hat Enterprise Linux 7 and CentOS 7 distributions don&#8217;t support user-level systemd services, but a system-level service is still possible, as this section describes.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a <code>systemd</code> service to update the Antigen plugins.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">/etc/systemd/system/update-jordan-antigen.service</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Update Jordan's Antigen plugins for ZSH</span>
<span class="py">After</span><span class="p">=</span><span class="s">network-online.target</span>
<span class="py">Wants</span><span class="p">=</span><span class="s">network-online.target</span>

<span class="nn">[Service]</span>
<span class="py">Type</span><span class="p">=</span><span class="s">oneshot</span>
<span class="py">User</span><span class="p">=</span><span class="s">jordan</span>
<span class="py">Group</span><span class="p">=</span><span class="s">jordan</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/usr/bin/zsh -c '. "$0" &amp;&amp; exec "$@"' /home/jordan/.zshrc antigen update</span>

<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">multi-user.target</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This systemd unit executes the <code>antigen update</code> command after loading the <code>.zshrc</code> file for the user <code>jordan</code>.<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>
This is run as the user <code>jordan</code> and it requires the network be online in order to update.</p>
</div>
</div>
</div>
</li>
<li>
<p>Verify the <code>network-online.target</code> exists.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span>systemctl is-enabled NetworkManager-wait-online.service
enabled</code></pre>
</div>
</div>
</li>
<li>
<p>Test run the new <code>systemd</code> unit.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span><span class="nb">sudo </span>systemctl start update-jordan-antigen.service</code></pre>
</div>
</div>
</li>
<li>
<p>Check the output of the command to make sure everything worked.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span><span class="nb">sudo </span>systemctl status update-jordan-antigen.service
● update-jordan-antigen.service - Update Jordan<span class="se">\'</span>s Antigen plugins <span class="k">for </span>ZSH
   Loaded: loaded <span class="o">(</span>/etc/systemd/system/update-jordan-antigen.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
   Active: inactive <span class="o">(</span>dead<span class="o">)</span>

Sep 16 14:12:36 jwillikers systemd[1]: Starting Update Jordan<span class="se">\'</span>s Antigen plugins <span class="k">for </span>ZSH...
Sep 16 14:12:37 jwillikers zsh[315]: Updating robbyrussell/oh-my-zsh@master... Done. Took 1s.
Sep 16 14:12:38 jwillikers zsh[315]: Updating zsh-users/zsh-autosuggestions@master... Done. Took 1s.
Sep 16 14:12:38 jwillikers zsh[315]: Updating zsh-users/zsh-completions@master... Done. Took 0s.
Sep 16 14:12:39 jwillikers zsh[315]: Updating zsh-users/zsh-syntax-highlighting@master... Done. Took 1s.
Sep 16 14:12:39 jwillikers systemd[1]: Started Update Jordan<span class="se">\'</span>s Antigen plugins <span class="k">for </span>ZSH.</code></pre>
</div>
</div>
</li>
<li>
<p>Add a systemd timer to update the Antigen plugins once per week.</p>
<div class="listingblock">
<div class="title">/etc/systemd/system/update-jordan-antigen.timer</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Update Antigen weekly</span>

<span class="nn">[Timer]</span>
<span class="py">Persistent</span><span class="p">=</span><span class="s">true</span>
<span class="py">OnCalendar</span><span class="p">=</span><span class="s">weekly</span>

<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">timers.target</span></code></pre>
</div>
</div>
</li>
<li>
<p>Activate the Antigen update timer on system startup.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>update-jordan-antigen.timer
Created symlink from /etc/systemd/system/timers.target.wants/update-jordan-antigen.timer to /etc/systemd/system/update-jordan-antigen.timer.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This timer has <code>Persistent=true</code> to account for the situation when the timer would fire but the system is not powered on.
With this option, the timer will just fire the next the system boots.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>That&#8217;s the tutorial.
You should now have a working systemd service to automatically update your ZSH plugins for you each week.
Don&#8217;t forget to disable your update service when you decide to make the switch to the <a href="https://fishshell.com/">Fish shell</a>. 🐟</p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://stackoverflow.com/a/49765275/9835303">StackOverflow: Using a user&#8217;s .bashrc in a systemd service</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="https://wiki.archlinux.org/index.php/Systemd/User#Basic_setup">Arch Wiki: systemd/user - Basic Setup</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="https://help.tableau.com/current/server-linux/en-us/systemd_user_service_error.htm">Tableau Help: systemd User Service Failures</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="https://stackoverflow.com/a/49765275/9835303">StackOverflow: Using a user&#8217;s .bashrc in a systemd service</a>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. <a href="https://www.freedesktop.org/wiki/Software/systemd/NetworkTarget/">Running Services After the Network is up</a>
</div>
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/jwillikers/blog2" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Jordan Williams <br /> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"> <img alt="Creative Commons License" style="border-width:0"
  src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
<br /> <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
  property="dct:title" rel="dct:type">JWillikers</span> by 
  <a xmlns:cc="http://creativecommons.org/ns#" href="https://jwillikers.com"
  property="cc:attributionName" rel="cc:attributionURL">Jordan Williams</a>
  is licensed under a 
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  Creative Commons Attribution-ShareAlike 4.0 International License</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
